alertmanager:
  config:
    global:
      resolve_timeout: 5m
    route:
      group_by: ['alertname']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h

      receiver: 'tg'
      routes:
        - receiver: 'null'
          match:
            alertname: 'Watchdog'

        - receiver: 'tg'
          match_re:
            alertname: '.*'
          continue: true

    receivers:
    - name: 'null'
    - name: 'tg'
      webhook_configs:
        - send_resolved: true
          url: 'http://192.168.1.7:8080'

additionalPrometheusRulesMap:
  aws-ecr:
    groups:
      - name: vuln_count
        rules:

          - alert: vuln_high
            expr: count(aws_ecr_image_scan_severity_count{severity="HIGH"}) > 0
            labels:
              severity: critical
              namespace: prometheus-stack
            annotations:
              description: Found one or more images with high vuln

          - alert: vuln_medium
            expr: count(aws_ecr_image_scan_severity_count{severity="MEDIUM"}) > 0
            labels:
              severity: warning
              namespace: prometheus-stack
            annotations:
              description: Found one or more images with medium vuln

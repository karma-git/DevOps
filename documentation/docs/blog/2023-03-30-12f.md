---
title: "KK - 12 Factor App"
tags:
  - kode-kloud
  - python
comments: true
---

# KK - 12 Factor App

–°—É—Ö–æ–π –∫–æ–Ω—Å–ø–µ–∫—Ç –∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –∫—É—Ä—Å—É 12 Factor App –æ—Ç KodeKloud, –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –º—ã—Å–ª—è–º–∏ –∞–≤—Ç–æ—Ä–∞

## Intro

- –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç [KK](https://kodekloud.com/wp-content/uploads/2023/03/12-Factor-App.pdf), [—Ñ–æ—Ä–∫ –Ω–∞ y.disk](https://disk.yandex.ru/i/_5PkjylyBHFlNg)
- [https://12factor.net/](https://12factor.net/) - –º–∞–Ω–∏—Ñ–µ—Å—Ç
- [https://videos.itrevolution.com/watch/432442730/](https://kodekloud.com/wp-content/uploads/2023/03/12-Factor-App.pdf) - `12 factor terraform`

<embed src="https://disk.yandex.ru/i/_5PkjylyBHFlNg" type="application/pdf" width="100%" height="600px" />

12-—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - —ç—Ç–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä—è–¥ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö, —É—Å—Ç–æ–π—á–∏–≤—ã—Ö –∏ –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –æ–±–ª–∞—á–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

–í–æ—Ç 12 –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å 12-—Ñ–∞–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ –≤–µ—Ä—Å–∏–∏ chat-gpt):

1. –ö–æ–¥ –±–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã—Ö –≤–µ—Ä—Å–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π.
2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —è–≤–Ω–æ –∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è.
3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
4. Backing —Å–µ—Ä–≤–∏—Å—ã (–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ç.–¥.) –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã.
5. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–∞–∫ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è.
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–æ –∫–∞–∫ –ø–æ—Ç–æ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.
7. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ —Å –ø–æ–º–æ—â—å—é –∫–æ–¥–æ–≤ –≤–æ–∑–≤—Ä–∞—Ç–∞.
8. –ü—Ä–æ—Ü–µ—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã.
9. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å—Ä–µ–¥—É.
10. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏.
11. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.
12. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞–≥—Ä—É–∑–∫–∏.

–°–æ–±–ª—é–¥–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –ø–æ–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –≤ –æ–±–ª–∞—á–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

## 1. Codebase (32) - (VCS)

- –ö–æ–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ VCS, –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å –Ω–∏–º –º–æ–∂–Ω–æ –±—ã–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π
- –°—É—â–Ω–æ—Å—Ç–∏ —Å–ª–µ–¥—É–µ—Ç –¥—Ä–æ–±–∏—Ç—å –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- ‚ùì–ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å –≤ IaC-–µ? –ù–∞–ø—Ä–∏–º–µ—Ä –µ—Å—Ç—å –• –∫–æ–º–∞–Ω–¥, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏–Ω—Ñ—Ä—É: —Å–µ—Ç—å, —Å–µ—Ä–≤–µ—Ä–∞
    - –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –≤ –æ–¥–Ω–æ–º tf –ø—Ä–æ–µ–∫—Ç–µ –º–µ–Ω–µ–¥–∂–∏—Ç—å –∏ —Å–µ—Ç—å, –∏ —Å–µ—Ä–≤–µ—Ä–∞
    - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ç—è–º–∏ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
    - –µ—Å–ª–∏ —É –Ω–∞—Å –¥–æ–±–∞–≤–∏—Ç—å—Å—è –µ—â–µ –∫—É—á–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, —Ç–∏–ø–∞ bd, s3, X, —Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Ä–æ–±–∏—Ç—å —ç—Ç–æ —Å–ª–µ–≥–∫–∞ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞? `tf-modules?`

## 2. Dependencies (43) - (Dockerfile | .lock )
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ª–µ–¥—É–µ—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏, –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∂–µ—Å—Ç–∫–æ –∑–∞–ø–∏–Ω–µ–Ω—ã *(—è –¥—É–º–∞—é —Å–ª–µ–¥—É–µ—Ç –¥–æ–ø—É—Å–∫–∞—Ç—å –ª–µ–≥–∫–∏–π —Ñ–ª–µ–∫—Å —á–µ—Ä–µ–∑ version-constraints, —Ç–∏–ø–∞ 0.1.X, –Ω–æ —ç—Ç–æ —Ä–∏—Å–∫)*

## 3. Config (71) - (env)

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è *(–Ω–æ —è –±—ã —Å–∫–∞–∑–∞–ª, —á—Ç–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—á –º–µ–ª–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≥–æ–¥–∏—Ç—Å—è, `—Ö–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä —Ñ–ª–µ–∫—Å–∞ - traefik`, –æ–Ω –º–æ–∂–µ—Ç –≤ config.toml, env_vars, –∞ —Ç–∞–∫ –∂–µ —Ñ–ª–∞–≥–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ - —É –≤—Å–µ–≥–æ —ç—Ç–æ —á—É—Ç—å-—á—É—Ç—å —Ä–∞–∑–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)*
- ‚ùì¬†–ï—Å–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å –æ–± –∏–Ω—Ñ—Ä–µ, —Ç–æ –∫–∞–∫ —Ç—É—Ç *—Å–æ—Ö—Ä–∞–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å* —Ç–µ–º–ø–ª–µ–π—Ç–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ç–µ–º–ø–ª–µ–π—Ç—ã?

## 4. Backing Services (67) - (DB | cache)

- Backing —Å–µ—Ä–≤–∏—Å—ã (–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ç.–¥.) –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã.
- ‚ùì¬†- —è–≤–ª—è–µ—Ç—Å—è –ª–∏ PVC —Ç–∞–∫–∏–º —Å–µ—Ä–≤–∏—Å–æ–º? ü§£
- ‚ùì¬†- –µ—Å–ª–∏ –º—ã –≤ infra-e, —Ç–æ –¥–ª—è –Ω–∞—Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è helm chart, –∞ –∫–∞–∫ –º—ã –∏—Ö –±—É–¥–µ–º –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ —Ç–∞–∫ –≤–∞–∂–Ω–æ? (*helm install / argocd / flux* ) - –∑–≤—É—á–∏—Ç –æ—á –Ω–∞—Ç—è–Ω—É—Ç–æ üòâ

## 5. Build, release, run (77) - (DevOps | CI/CD/CD -> SRE)

- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É:
    - —Å–±–æ—Ä–∫–æ–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
    - —Ä–µ–ª–∏–∑–æ–º (–¥–æ—Å—Ç–∞–≤–∫–∞ + –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ CD/CD)
    - –æ–ø–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º

## 6. Processes (57) - (SIGTERM | SIGKILL)

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç–µ–π—Ç–ª–µ—Å—Å, –±—ã—Å—Ç—Ä–æ —É–±–∏–≤–∞—Ç—å—Å—è, –∏ –±—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ–¥—ã –≤—ã—Ö–æ–¥–∞ –æ—Ç CRI, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –≤ –æ–±–ª–∞—á–Ω–æ–π —Å—Ä–µ–¥–µ

## 7. Port Binding (85) - (port-mapping)

- –º–∞–ª–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ –≤ –∫—É–±–µ—Ä–µ, –≤–æ–∑–º–æ–∂–Ω–æ —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ—Ä—Ç –∫–∞–∫ ENV, –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –º—ã –∑–∞–¥—É–º–∞–µ–º –∑–∞–ø–∏—Ö–∞—Ç—å –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –æ–¥–∏–Ω Pod / docker-compose service?

## 8. Concurrency (55) - (HPA)

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–º–µ—Ç—å `–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è`, –ø–æ—ç—Ç–æ–º—É –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `—Å—Ç–µ–π—Ç–ª–µ—Å—Å`

## 9. Disposability (90) - (GC)

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Å—Ç—Ä–æ –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è –∏ –±—ã—Å—Ç—Ä–æ —É–±–∏–≤–∞—Ç—å—Å—è

## 10. Dev/prod parity (95) - (tools | CI/CD)

- dev –∏ prod –ø–æ —Ç—É–ª–∞–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Ö–æ–∂–∏–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–∞

## 11. Logs (101)

- –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ stdout –∏ –∫–æ–ª–ª–µ–∫—Ç—è—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤ json

## 12. Admin Processes (107) - (declarative)

- –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ç–∞—Å–∫–∏ —Ç–∏–ø–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º–∏, IaC

## –ü—Ä–∏–º–µ—Ä: fastapi-12-factor

–ü—Ä–∏–º–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –æ—Ç KK

–ö–æ–¥ - https://github.com/karma-git/fastapi-12-factor

### 1. Codebase

–°–ø–∏—Å–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤

=== ".env"

    ```env
    APP_LOGLEVEL = WARNING
    UVICORN_PORT = 8080
    REDIS_HOST = redis-db
    REDIS_PORT = 6379
    ```

=== "docker-compose.yml"

    ```yaml
    ---

    version: '3'

    services:
      api:
        container_name: "fastapi-12f"
        image: karmawow/fastapi-12f:latest
        build:
          context: ./
          dockerfile: Dockerfile
        volumes:
          - ./:/home/app
        env_file:
          - .env
        restart: always
        ports:
          # machine:container
          - "8000:8080"

      redis-db:
        image: redis
        container_name: redis
        command: redis-server /usr/local/etc/redis/redis.conf
        ports:
          - "6379:6379"
        volumes:
          - ./data:/data
          - ./redis.conf:/usr/local/etc/redis/redis.conf
    ```

=== "Dockerfile"

    ```dockerfile
    FROM python:3.10.0-alpine3.14

    COPY ./requirements.txt ./requirements.txt

    RUN pip install --no-cache-dir -r requirements.txt

    RUN addgroup --gid 10001 app \
      && adduser \
        --uid 10001 \
        --home /home/app \
        --shell /bin/ash \
        --ingroup app \
        --disabled-password \
        app

    WORKDIR /home/app

    USER app

    COPY ./ /home/app

    # default, can be overrided
    ENV UVICORN_PORT 8000
    EXPOSE 8000

    ENTRYPOINT ["/usr/local/bin/uvicorn"]
    CMD ["main:app", "--reload", "--host=0.0.0.0",  "--no-access-log"]
    ```

=== "main.py"

    ```python
    import os
    import logging

    from fastapi import FastAPI
    from pydantic import BaseSettings
    import redis

    import json_log_formatter


    class Settings(BaseSettings):
        app_name: str = "Awesome API"
        app_log_level: str = os.environ.get('APP_LOGLEVEL', 'INFO').upper()
        port: int = os.environ.get("UVICORN_PORT", 8000)
        redis_host: str = os.environ.get("REDIS_HOST", "redis-db")
        redis_port: int = os.environ.get("REDIS_PORT", 6380)

    settings = Settings()

    logger = logging.getLogger(__name__)
    stdout = logging.StreamHandler()
    stdout.setLevel(level=settings.app_log_level)
    formatter = json_log_formatter.VerboseJSONFormatter()
    stdout.setFormatter(formatter)
    logger.addHandler(stdout)

    app = FastAPI()
    redis_db = redis.Redis(host=settings.redis_host, port=settings.redis_port)

    @app.get("/")
    async def welcomeToKodeKloud():
        try:
          redis_db.incr('visitorCount')
          visitCount = str(redis_db.get('visitorCount'), 'utf-8')
        except redis.exceptions.ConnectionError as e:
            logger.critical(e)
            return {"message": "Welcome to KODEKLOUD!"}
        else:
            logger.debug(visitCount)
            return {"message": "Welcome to KODEKLOUD!", "request_count": visitCount}

    @app.get("/info")
    async def info():
        return {
            "app_name": settings.app_name,
            "app_log_level": settings.app_log_level,
            "app_port": settings.port,
            "redis_host": settings.redis_host,
            "redis_port": settings.redis_port,
        }
    ```

=== "requirements.txt"

    ```txt
    # pip install fastapi uvicorn
    # pip freeze | tee requirement.txt
    anyio==3.6.2
    click==8.1.3
    fastapi==0.95.0
    h11==0.14.0
    idna==3.4
    pydantic==1.10.7
    sniffio==1.3.0
    starlette==0.26.1
    typing_extensions==4.5.0
    uvicorn==0.21.1
    async-timeout==4.0.2
    redis==4.5.4
    JSON-log-formatter==0.5.2
    ```

### 2. Dependencies

–•—Ä–∞–Ω–∏–º –≤—Å–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ —Ñ–∞–π–ª–µ, –∞ —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ–º –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç Dockerfile:

=== "requirements.txt"

    ```txt
    # pip install fastapi uvicorn
    # pip freeze | tee requirement.txt
    anyio==3.6.2
    ...
    ```

=== "Dockerfile"

    ```dockerfile
    ...

    # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
    COPY ./requirements.txt ./requirements.txt

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    RUN pip install --no-cache-dir -r requirements.txt

    ...
    ```

### 3. Config; Backend; Port-Binding; Logs

=== ".env"

    ```env
    # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    APP_LOGLEVEL = WARNING

    # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç server
    # –ü—Ä–∏ —Å–º–µ–Ω–µ, –º—ã –¥–æ–ª–∂–Ω—ã —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Infrastructure —Ç–∞–∫–∂–µ –µ–≥–æ –ø–æ–º–µ–Ω—è—Ç—å
    UVICORN_PORT = 8080

    # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π hostname redis
    # –ü—Ä–∏ —Å–º–µ–Ω–µ, –º—ã –¥–æ–ª–∂–Ω—ã —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Infrastructure —Ç–∞–∫–∂–µ –µ–≥–æ –ø–æ–º–µ–Ω—è—Ç—å
    REDIS_HOST = redis-db

    # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç redis
    # –ü—Ä–∏ —Å–º–µ–Ω–µ, –º—ã –¥–æ–ª–∂–Ω—ã —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Infrastructure —Ç–∞–∫–∂–µ –µ–≥–æ –ø–æ–º–µ–Ω—è—Ç—å
    REDIS_PORT = 6379
    ```

=== "Dockerfile"

    ```dockerfile
    ...

    # —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç uvicorn
    ENV UVICORN_PORT 8000
    EXPOSE 8000

    # –≤–æ–∑–º–æ–∂–Ω–æ –±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ uvicorn –≤ main.py
    # –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å python, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º argparse
    # –Ω–æ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã infra –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ENTRYPOINT –∏ CMD
    ENTRYPOINT ["/usr/local/bin/uvicorn"]
    CMD ["main:app", "--reload", "--host=0.0.0.0",  "--no-access-log"]
    ```

=== "docker-compose.yml"

    ```yaml
    ---
    ...

    services:
      api:
        ...
        # –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ –≤ —Ä–∞–Ω—Ç–∞–π–º
        env_file:
          - .env
        ports:
          # –º–∞–ø–∏–Ω–≥ –ø–æ—Ä—Ç–æ–≤
          # docker-host:container, –≥–¥–µ –ø–æ—Ä—Ç –≤ container –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º UVICORN_PORT –∏–∑ env
          - "8000:8080"

      # –∑–Ω–∞—á–µ–Ω–∏–µ REDIS_HOST –∏–∑ env –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å
      redis-db:
        # docker-host:container, –≥–¥–µ –ø–æ—Ä—Ç –≤ container –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∑–Ω–∞—á–µ–Ω–∏–µ–º REDIS_PORT –∏–∑ env
        ports:
          - "6379:6379"
    ```

=== "main.py"

    ```python
    import os
    import logging

    from fastapi import FastAPI
    from pydantic import BaseSettings
    import redis

    import json_log_formatter

    # –ö–ª–∞—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ pydantic
    class Settings(BaseSettings):
        app_name: str = "Awesome API"
        app_log_level: str = os.environ.get('APP_LOGLEVEL', 'INFO').upper()
        port: int = os.environ.get("UVICORN_PORT", 8000)
        redis_host: str = os.environ.get("REDIS_HOST", "redis-db")
        redis_port: int = os.environ.get("REDIS_PORT", 6380)

    # –û–±—ä–µ–∫—Ç dict, —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    settings = Settings()

    ...

    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    # –ü–æ–ª—É—á–∞–µ–º –ª–æ–≥–≥–µ—Ä –∏–∑ —Ñ–∞–π–ª–∞
    logger = logging.getLogger(__name__)
    # —Å–æ–∑–¥–∞–µ–º log —Ö—ç–Ω–¥–ª–µ—Ä
    stdout = logging.StreamHandler()
    # –∑–∞–¥–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, TODO: –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
    stdout.setLevel(level=settings.app_log_level)
    # —Å–æ–∑–¥–∞–µ–º json —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä
    formatter = json_log_formatter.VerboseJSONFormatter()
    # –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –∫ —Ö—ç–Ω–¥–ª–µ—Ä—É
    stdout.setFormatter(formatter)
    # –≤–µ—à–∞–µ–º —Ö—ç–Ω–¥–ª–µ—Ä –Ω–∞ –ª–æ–≥–≥–µ—Ä
    logger.addHandler(stdout)

    # –ø–æ–¥–∫–ª—é—á–∞–µ–º –∫ redis —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    redis_db = redis.Redis(host=settings.redis_host, port=settings.redis_port)

    @app.get("/")
    async def welcomeToKodeKloud():
        try:
          redis_db.incr('visitorCount')
          visitCount = str(redis_db.get('visitorCount'), 'utf-8')
        # –û—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏ –∏–Ω—Ñ—Ä—ã –∏ –ª–æ–≥–∏—Ä—É–µ–º –∏—Ö
        except redis.exceptions.ConnectionError as e:
            logger.critical(e)
            return {"message": "Welcome to KODEKLOUD!"}
        else:
            logger.debug(visitCount)
            return {"message": "Welcome to KODEKLOUD!", "request_count": visitCount}
    ```
